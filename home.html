<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8" />

		<title>using Html &amp; CSS Only</title>

		<link rel="stylesheet" href="./index.css" />
		<script src="/config/config.js"></script>
	</head>

	<body>
		<!-- partial:index.partial.html -->

		<section>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>
			<span></span> <span></span> <span></span> <span></span> <span></span>


			

			<div class="signin">
				<div class="content">
					<div style="z-index: 5;color:white">
						<b> Logged in As <a style="text-decoration: none;color:greenyellow" id="uf"> </a>, <i><ins id="logoi"> </ins> </i></b>
					</div>
					<h2>Join A Battle</h2>

					<div class="form">
						<div class="inputBox">
							<input type="text" id="code" required />
							<i>Enter Battle Code</i>
						</div>

						<div class="inputBox">
							<input type="text" id="pass" required />
							<i>Enter Replay Code</i>
						</div>

						<div class="inputBox">
							<select id="as" placeholder="Join As">
								<option value="">-- Join As --</option>
								<option value="part">Player</option>
								<option value="spect">Spectator</option>
							</select>
						</div>

						<div class="inputBox">
							<input type="submit" onClick="joinB()" value="Join Battle" />
						</div>
					</div>
				</div>
			</div>
		</section>
		<script src="./socketevents.js"></script>
		<script>

function initU() {
	let userField = document.getElementById("uf");
	let logoi = document.getElementById("logoi");
	let user = JSON.parse(localStorage.getItem("user"));
	let token = localStorage.getItem("token");
	if(token && token != "Guest" && !user) window.location.reload();
	if(!user) return logoi.innerHTML = `<a style="text-decoration: none;color:rgb(47, 106, 255)" onclick="window.location.href='login.html'"> Login</a>`;
	userField.innerHTML = user.name;
	logoi.innerHTML = `<a style="text-decoration: none;color:rgb(47, 106, 255)" onclick="logout()"> Logout</a>`;
}
			function logout() {
				let token = localStorage.getItem("token");
				if(!token || token == "Guest") return alert("You're not logged in");
				ws.send("%logout%" + token)
			}
	
			function joinB() {
				let name = document.getElementById("code").value.trim();
				let pass = document.getElementById("pass").value;
				let jas = document.getElementById("as").value;

				if (name.length < 4 && pass < 1) {
					alert("Battle Code must be 4-letter alphanumeric value");
					return;
				}

				if (pass.length > 1 && name.length > 1) {
					alert(
						"you cannot join a battle and view a replay at the same time"
					);
					return;
				}

				if (name.length && jas.length < 2)
					return alert(
						"Please select whether you're joining as player or spectator"
					);

				let token = localStorage.getItem("token");

				if (jas == "part" && !token)
					return alert("You need to login before joining as a player");

				if (jas == "spect" && !token)
					localStorage.setItem("token", "Guest");

				let temp = JSON.parse(localStorage.getItem("parts"))
					? JSON.parse(localStorage.getItem("parts"))
					: {};

				if (jas == "part") temp[name] = true;
				localStorage.setItem("parts", JSON.stringify(temp));

				if(pass.length > 5) {
					ws.send("%hasReplay%" + pass.trim());
					return;
					//let replays = localStorage.getItem("replays") ? localStorage.getItem("replays") : [];
					
				}

				ws.send(
					"%j%" + name + "%" + jas + "%" + localStorage.getItem("token")
				);
			}

			initU();
		</script>
	</body>
</html>
